<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Google AI Image Generator</title>
</head>

<body style="font-family: sans-serif; background:#111; color:#fff; padding:20px;">

  <h1>Google Image Generator</h1>

  <input type="file" id="imageInput" accept="image/*"><br><br>

  <textarea id="prompt" style="width:100%; height:120px;">
Character sheet of this uploaded character
  </textarea>

  <button onclick="generate()" style="padding:10px 20px; margin-top:20px;">Generate</button>

  <pre id="status" style="white-space:pre-wrap; background:#222; padding:10px; margin-top:20px;"></pre>

  <div id="output" style="margin-top:20px;"></div>


<script>
// convert image file to base64 string
function toBase64(file) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(",")[1]); // remove "data:..."
    reader.readAsDataURL(file);
  });
}

async function generate() {
  const status = document.getElementById("status");
  const output = document.getElementById("output");
  const file = document.getElementById("imageInput").files[0];
  const prompt = document.getElementById("prompt").value;

  if (!file) { status.textContent = "Please upload an image first."; return; }

  status.textContent = "Converting image...";

  const imageBase64 = await toBase64(file);

  status.textContent = "Sending to Google API...";

  const res = await fetch("/api/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ prompt, imageBase64 })
  });

  const json = await res.json();
  status.textContent = JSON.stringify(json, null, 2);

  try {
    const img = json.predictions[0].bytesBase64Encoded;
    output.innerHTML = `<img src="data:image/png;base64,${img}" style="max-width:100%;">`;
  } catch (e) {
    output.innerHTML = "No image produced.";
  }
}
</script>

</body>
</html>
